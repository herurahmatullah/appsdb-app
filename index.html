<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Database Kepegawaian</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .btn-spinner { border: 3px solid rgba(255, 255, 255, 0.3); border-top-color: #fff; border-radius: 50%; width: 20px; height: 20px; animation: spin 0.8s linear infinite; display: inline-block; vertical-align: middle; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100">
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100">

    <!-- Halaman Login (Tampil secara default) -->
    <div id="loginpage">
        <div class="flex items-center justify-center min-h-screen">
            <div class="relative flex flex-col m-6 space-y-8 bg-white shadow-2xl rounded-2xl md:flex-row md:space-y-0">
                <div class="relative flex flex-col justify-center p-8 text-white bg-gradient-to-r from-cyan-500 to-blue-500 rounded-2xl md:w-[400px]">
                    <div class="absolute inset-0 bg-black opacity-20 rounded-2xl"></div>
                    <div class="relative z-10 text-center md:text-left">
                        <p class="text-5xl font-bold tracking-wide">Selamat Datang!</p>
                        <p class="mt-4 text-lg">Silakan masuk untuk mengakses sistem.</p>
                    </div>
                </div>
                <div class="flex flex-col justify-center p-8 md:p-14 md:w-[400px]">
                    <div class="text-center">
                        <h2 class="mb-4 text-4xl font-bold text-gray-800">Aplikasi Database Kepegawaian</h2>
                        <p class="text-lg font-light text-gray-600">oleh<br>Heru Rahmatullah, S.P.</p>
                    </div>
                    <form id="loginForm" class="mt-8">
                        <div class="py-4">
                            <label for="email" class="mb-2 text-md font-medium text-gray-700">Email</label>
                            <input type="text" id="email" required class="w-full p-3 mt-1 bg-gray-50 border border-gray-300 text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="py-4">
                            <label for="password" class="mb-2 text-md font-medium text-gray-700">Password</label>
                            <input type="password" id="password" required class="w-full p-3 mt-1 bg-gray-50 border border-gray-300 text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div id="error" class="text-red-500 text-center h-5 my-2"></div>
                        <button type="submit" id="loginButton" class="w-full p-3 mt-4 font-bold text-white bg-blue-600 rounded-md hover:bg-blue-700 flex items-center justify-center disabled:bg-gray-400">
                            <span id="buttonSpinner" class="hidden btn-spinner mr-2"></span>
                            <span id="buttonText">Login</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Halaman Dashboard (Tersembunyi secara default) -->
<div id="dashboardpage" style="display:none;">
    <!-- HEADER -->
    <header class="bg-white shadow-md w-full">
        <nav class="flex items-center justify-between w-full px-4 py-4 md:px-10">
            <!-- Kiri: Hari, tanggal, jam -->
            <div id="datetimeArea" class="text-gray-700 font-medium text-sm md:text-base"></div>
            <!-- Tengah: Judul -->
            <div class="flex-1 text-center">
                <h1 class="text-xl md:text-2xl font-bold text-gray-800">
                    Aplikasi Database Kepegawaian<br>
                    <span class="font-normal text-base md:text-lg">oleh Heru Rahmatullah, S.P.</span>
                </h1>
            </div>
            <!-- Kanan: User & Logout -->
            <div class="flex items-center gap-2">
                <span class="mr-2 text-gray-700 text-sm md:text-base">
                    Selamat datang, <strong id="userLabel"></strong>
                </span>
                <button onclick="logoutUser()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg">
                    Logout
                </button>
            </div>
        </nav>
    </header>

    <!-- NAVBAR MENU (di bawah header) -->
    <nav id="mainMenu" class="w-full bg-blue-600 shadow-md">
      <ul class="flex flex-wrap items-center justify-center gap-1 md:gap-4 px-2 py-2">
        <li>
          <a href="#" class="text-white font-medium px-3 py-1.5 rounded hover:bg-blue-700 transition" data-menu="beranda">Beranda</a>
        </li>
        <li class="menu-admin">
          <a href="#" class="text-white font-medium px-3 py-1.5 rounded hover:bg-blue-700 transition" data-menu="asn">Data ASN</a>
        </li>
        <li class="menu-admin">
          <a href="#" class="text-white font-medium px-3 py-1.5 rounded hover:bg-blue-700 transition" data-menu="pns">Data PNS</a>
        </li>
        <li class="menu-admin">
          <a href="#" class="text-white font-medium px-3 py-1.5 rounded hover:bg-blue-700 transition" data-menu="cpns">Data CPNS</a>
        </li>
        <li class="menu-admin">
          <a href="#" class="text-white font-medium px-3 py-1.5 rounded hover:bg-blue-700 transition" data-menu="pppk">Data PPPK</a>
        </li>
        <li class="menu-admin">
          <a href="#" class="text-white font-medium px-3 py-1.5 rounded hover:bg-blue-700 transition" data-menu="pangkat">Data Pangkat</a>
        </li>
        <li class="menu-admin">
          <a href="#" class="text-white font-medium px-3 py-1.5 rounded hover:bg-blue-700 transition" data-menu="gaji">Data Gaji Berkala</a>
        </li>
        <li class="menu-admin">
          <a href="#" class="text-white font-medium px-3 py-1.5 rounded hover:bg-blue-700 transition" data-menu="mutasi">Data Mutasi</a>
        </li>
        <li class="menu-admin">
          <a href="#" class="text-white font-medium px-3 py-1.5 rounded hover:bg-blue-700 transition" data-menu="pensiun">Data Pensiun</a>
        </li>
        <li class="menu-admin">
          <a href="#" class="text-white font-medium px-3 py-1.5 rounded hover:bg-blue-700 transition" data-menu="log">Log</a>
        </li>
        <li class="menu-admin relative group">
          <a href="#" 
            class="text-white font-medium px-3 py-1.5 rounded hover:bg-blue-700 transition flex items-center"
            data-menu="pengaturan"
            id="menuPengaturanBtn">
            Pengaturan
            <svg class="w-4 h-4 ml-1 inline-block" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </a>
          <!-- Submenu -->
          <ul id="submenuPengaturan"
              class="hidden group-hover:flex group-focus-within:flex flex-col absolute top-full left-1/2 -translate-x-1/2 min-w-[160px] bg-white dark:bg-gray-900 border border-blue-100 dark:border-gray-700 rounded-xl shadow-lg z-50 transition duration-150">
            <li>
              <a href="#" data-subpengaturan="akses" class="block px-4 py-2 text-gray-800 dark:text-gray-100 hover:bg-blue-50 dark:hover:bg-gray-800 rounded-t-xl">Akses Menu</a>
            </li>
            <li>
              <a href="#" data-subpengaturan="user" class="block px-4 py-2 text-gray-800 dark:text-gray-100 hover:bg-blue-50 dark:hover:bg-gray-800 rounded-b-xl">User</a>
            </li>
          </ul>
        </li>
      </ul>
    </nav>

    <!-- MAIN CONTENT -->
    <main id="mainContent" class="w-full p-2 md:p-6"></main>

    <!-- Modal Konfirmasi Hapus User -->
    <div id="modalHapusUser" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30 hidden">
        <div class="bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-xs text-center">
            <div class="text-red-500 mb-3">
                <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01M5.07 17A10 10 0 1112 22a10 10 0 01-6.93-5z" />
                </svg>
            </div>
            <div class="text-lg font-bold mb-1 text-gray-800 dark:text-gray-100">Yakin ingin menghapus user ini?</div>
            <div class="text-gray-600 dark:text-gray-200 mb-4" id="hapusUserNama"></div>
            <div class="flex justify-center gap-3">
                <button id="btnBatalHapus" class="px-4 py-2 rounded bg-gray-400 hover:bg-gray-500 text-white">Batal</button>
                <button id="btnKonfirmasiHapus" class="px-4 py-2 rounded bg-red-600 hover:bg-red-700 text-white font-bold">Hapus</button>
            </div>
        </div>
    </div>

    
<script>
    function renderDashboardBox() {
    document.getElementById('mainContent').innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="bg-blue-500 text-white rounded-xl shadow-lg flex flex-col items-center py-8">
                <span class="text-lg font-semibold">Jumlah ASN</span>
                <span id="jumlahASN" class="text-3xl font-bold mt-2">0</span>
            </div>
            <div class="bg-green-500 text-white rounded-xl shadow-lg flex flex-col items-center py-8">
                <span class="text-lg font-semibold">Jumlah PNS</span>
                <span id="jumlahPNS" class="text-3xl font-bold mt-2">0</span>
            </div>
            <div class="bg-yellow-400 text-gray-900 rounded-xl shadow-lg flex flex-col items-center py-8">
                <span class="text-lg font-semibold">Jumlah CPNS</span>
                <span id="jumlahCPNS" class="text-3xl font-bold mt-2">0</span>
            </div>
            <div class="bg-purple-600 text-white rounded-xl shadow-lg flex flex-col items-center py-8">
                <span class="text-lg font-semibold">Jumlah PPPK</span>
                <span id="jumlahPPPK" class="text-3xl font-bold mt-2">0</span>
            </div>
        </div>
    `;
    const jumlahData = { asn: 1234, pns: 1000, cpns: 150, pppk: 84 };
    document.getElementById('jumlahASN').innerText = jumlahData.asn;
    document.getElementById('jumlahPNS').innerText = jumlahData.pns;
    document.getElementById('jumlahCPNS').innerText = jumlahData.cpns;
    document.getElementById('jumlahPPPK').innerText = jumlahData.pppk;
}

function renderNotAvailable(menuTitle) {
    document.getElementById('mainContent').innerHTML = `
        <div class="flex flex-col items-center justify-center min-h-[250px] bg-white rounded-xl shadow-md py-12">
            <svg class="w-16 h-16 text-blue-400 mb-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M12 2a10 10 0 110 20 10 10 0 010-20z" />
            </svg>
            <div class="text-2xl font-bold mb-2 text-gray-700">${menuTitle}</div>
            <div class="text-gray-600">Fitur belum tersedia.</div>
        </div>
    `;
}

function renderDataASN() {
    document.getElementById('mainContent').innerHTML = `
        <div class="text-center text-2xl md:text-3xl font-bold text-gray-800 mb-4">Data ASN</div>
        <!-- Filter -->
        <div class="flex flex-wrap md:flex-nowrap gap-2 mb-2">
            <input id="filterNama" type="text" class="flex-1 p-2 border rounded-md" placeholder="Nama">
            <input id="filterPangkat" type="text" class="flex-1 p-2 border rounded-md" placeholder="Pangkat">
            <input id="filterJabatan" type="text" class="flex-1 p-2 border rounded-md" placeholder="Jabatan">
            <input id="filterUnitKerja" type="text" class="flex-1 p-2 border rounded-md" placeholder="Unit Kerja">
            <button id="btnCariASN" class="w-28 md:w-32 h-11 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md shadow">Cari</button>
        </div>
        <div class="flex flex-wrap md:flex-nowrap gap-2 mb-4">
            <input id="filterNipBaru" type="text" class="flex-1 p-2 border rounded-md" placeholder="NIP Baru">
            <input id="filterTmtPangkat" type="date" class="flex-1 p-2 border rounded-md" placeholder="TMT Pangkat">
            <input id="filterTmtJabatan" type="date" class="flex-1 p-2 border rounded-md" placeholder="TMT Jabatan">
            <input id="filterInstansiInduk" type="text" class="flex-1 p-2 border rounded-md" placeholder="Instansi Induk">
            <button id="btnResetASN" class="w-28 md:w-32 h-11 bg-gray-400 hover:bg-gray-500 text-white font-bold rounded-md shadow">Reset</button>
        </div>
        <!-- Table -->
        <div class="overflow-auto bg-white rounded-xl shadow">
            <table class="min-w-full text-sm text-left">
                <thead>
                    <tr class="bg-blue-50 border-b">
                        <th class="px-3 py-2 text-center">No.</th>
                        <th class="px-3 py-2">Nama Lengkap</th>
                        <th class="px-3 py-2">NIP Baru</th>
                        <th class="px-3 py-2">Pangkat<br><span class="font-normal text-xs">(Gol./Ruang)</span></th>
                        <th class="px-3 py-2">TMT Pangkat</th>
                        <th class="px-3 py-2">Jabatan</th>
                        <th class="px-3 py-2">TMT Jabatan</th>
                        <th class="px-3 py-2">Unit Kerja</th>
                        <th class="px-3 py-2">Instansi Induk</th>
                        <th class="px-3 py-2 text-center">Aksi</th>
                    </tr>
                </thead>
                <tbody id="asnTableBody"></tbody>
            </table>
        </div>
        <!-- Pagination -->
        <div class="flex flex-wrap items-center justify-between mt-4 gap-2">
            <div class="text-gray-700 text-sm" id="paginationInfo">Menampilkan 0 data</div>
            <div class="flex items-center gap-1" id="paginationNav"></div>
            <div class="flex items-center gap-2">
                <span class="text-gray-700 text-sm">Tampilkan</span>
                <select class="p-1 border rounded" id="showPerPage">
                    <option>10</option>
                    <option>25</option>
                    <option>50</option>
                    <option>100</option>
                </select>
            </div>
        </div>
    `;
    // Event
    document.getElementById('btnCariASN').onclick = function() { currentPage = 1; fetchAndRender(); };
    document.getElementById('btnResetASN').onclick = function() {
        ['filterNama','filterPangkat','filterJabatan','filterUnitKerja','filterNipBaru','filterTmtPangkat','filterTmtJabatan','filterInstansiInduk']
        .forEach(id => document.getElementById(id).value = "");
        currentPage = 1;
        fetchAndRender();
    };
    document.getElementById('showPerPage').onchange = function() {
        rowsPerPage = parseInt(this.value);
        currentPage = 1;
        fetchAndRender();
    };
    fetchAndRender();
}

    // Meilisearch search
    
let allDataASN = [];
let currentPage = 1;
let rowsPerPage = 10;

// Panggil fungsi ini saat menu Data ASN diklik
function renderDataASN() {
    document.getElementById('mainContent').innerHTML = `
        <div class="text-center text-2xl md:text-3xl font-bold text-gray-800 mb-4">Data ASN</div>
        <!-- Filter -->
        <div class="flex flex-wrap md:flex-nowrap gap-2 mb-2">
            <input id="filterNama" type="text" class="flex-1 p-2 border rounded-md" placeholder="Nama">
            <input id="filterPangkat" type="text" class="flex-1 p-2 border rounded-md" placeholder="Pangkat">
            <input id="filterJabatan" type="text" class="flex-1 p-2 border rounded-md" placeholder="Jabatan">
            <input id="filterUnitKerja" type="text" class="flex-1 p-2 border rounded-md" placeholder="Unit Kerja">
            <button id="btnCariASN" class="w-28 md:w-32 h-11 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md shadow">Cari</button>
        </div>
        <div class="flex flex-wrap md:flex-nowrap gap-2 mb-4">
            <input id="filterNipBaru" type="text" class="flex-1 p-2 border rounded-md" placeholder="NIP Baru">
            <input id="filterTmtPangkat" type="date" class="flex-1 p-2 border rounded-md" placeholder="TMT Pangkat">
            <input id="filterTmtJabatan" type="date" class="flex-1 p-2 border rounded-md" placeholder="TMT Jabatan">
            <input id="filterInstansiInduk" type="text" class="flex-1 p-2 border rounded-md" placeholder="Instansi Induk">
            <button id="btnResetASN" class="w-28 md:w-32 h-11 bg-gray-400 hover:bg-gray-500 text-white font-bold rounded-md shadow">Reset</button>
        </div>
        <!-- Table -->
        <div class="overflow-auto bg-white rounded-xl shadow">
            <table class="min-w-full text-sm text-left">
                <thead>
                    <tr class="bg-blue-50 border-b">
                        <th class="px-3 py-2 text-center">No.</th>
                        <th class="px-3 py-2">Nama Lengkap</th>
                        <th class="px-3 py-2">NIP Baru</th>
                        <th class="px-3 py-2">Pangkat<br><span class="font-normal text-xs">(Gol./Ruang)</span></th>
                        <th class="px-3 py-2">TMT Pangkat</th>
                        <th class="px-3 py-2">Jabatan</th>
                        <th class="px-3 py-2">TMT Jabatan</th>
                        <th class="px-3 py-2">Unit Kerja</th>
                        <th class="px-3 py-2">Instansi Induk</th>
                        <th class="px-3 py-2 text-center">Aksi</th>
                    </tr>
                </thead>
                <tbody id="asnTableBody"></tbody>
            </table>
        </div>
        <div class="flex flex-wrap items-center justify-between mt-4 gap-2">
            <div class="text-gray-700 text-sm" id="paginationInfo">Menampilkan 0 data</div>
            <div class="flex items-center gap-1" id="paginationNav"></div>
            <div class="flex items-center gap-2">
                <span class="text-gray-700 text-sm">Tampilkan</span>
                <select class="p-1 border rounded" id="showPerPage">
                    <option>10</option>
                    <option>25</option>
                    <option>50</option>
                    <option>100</option>
                </select>
            </div>
        </div>
    `;

    document.getElementById('btnCariASN').onclick = function() { currentPage = 1; renderTablePage(); };
    document.getElementById('btnResetASN').onclick = function() {
        ['filterNama','filterPangkat','filterJabatan','filterUnitKerja','filterNipBaru','filterTmtPangkat','filterTmtJabatan','filterInstansiInduk']
        .forEach(id => document.getElementById(id).value = "");
        currentPage = 1;
        renderTablePage();
    };
    document.getElementById('showPerPage').onchange = function() {
        rowsPerPage = parseInt(this.value);
        currentPage = 1;
        renderTablePage();
    };

    document.getElementById('asnTableBody').innerHTML = `<tr><td colspan="10" class="py-8 text-center text-blue-500">Loading data ...</td></tr>`;
    fetch('https://063707fc-6341-4136-82c4-ad936aa7f29a-00-3bzwgw6kkd2o4.sisko.replit.dev/asn?limit=5000')
        .then(res => res.json())
        .then(json => {
            allDataASN = json.data || [];
            renderTablePage();
        });
}

function filterASN(data) {
    let nama = document.getElementById('filterNama').value.toLowerCase();
    let pangkat = document.getElementById('filterPangkat').value.toLowerCase();
    let jabatan = document.getElementById('filterJabatan').value.toLowerCase();
    let unit = document.getElementById('filterUnitKerja').value.toLowerCase();
    let nip = document.getElementById('filterNipBaru').value.toLowerCase();
    let tmtp = document.getElementById('filterTmtPangkat').value;
    let tmtj = document.getElementById('filterTmtJabatan').value;
    let instansi = document.getElementById('filterInstansiInduk').value.toLowerCase();

    return data.filter(row =>
        (!nama || (row.Nama||'').toLowerCase().includes(nama)) &&
        (!pangkat || (row.Pang_Gol_Ruang||'').toLowerCase().includes(pangkat)) &&
        (!jabatan || (row.Jabatan_Terakhir||'').toLowerCase().includes(jabatan)) &&
        (!unit || (row.Unit_Kerja||'').toLowerCase().includes(unit)) &&
        (!nip || (row.NIP_Baru||'').toLowerCase().includes(nip)) &&
        (!tmtp || (row.TMT_Pangkat||'') === tmtp) &&
        (!tmtj || (row.TMT_Jab||'') === tmtj) &&
        (!instansi || (row.Instansi_Induk||'').toLowerCase().includes(instansi))
    );
}

function renderTablePage() {
    let data = filterASN(allDataASN);
    let total = data.length;
    let startIdx = (currentPage - 1) * rowsPerPage;
    let endIdx = Math.min(startIdx + rowsPerPage, total);
    let tbody = '';
    for (let i = startIdx; i < endIdx; i++) {
        let row = data[i];
        tbody += `
            <tr class="border-b hover:bg-blue-50">
                <td class="px-3 py-2 text-center">${i + 1}</td>
                <td class="px-3 py-2">${(row.Gelar_Depan ? row.Gelar_Depan + ' ' : '') + row.Nama + (row.Gelar_Belakang ? ', ' + row.Gelar_Belakang : '')}</td>
                <td class="px-3 py-2">${row.NIP_Baru}</td>
                <td class="px-3 py-2">${row.Pang_Gol_Ruang}</td>
                <td class="px-3 py-2">${row.TMT_Pangkat}</td>
                <td class="px-3 py-2">${row.Jabatan_Terakhir}</td>
                <td class="px-3 py-2">${row.TMT_Jab}</td>
                <td class="px-3 py-2">${row.Unit_Kerja}</td>
                <td class="px-3 py-2">${row.Instansi_Induk}</td>
                <td class="px-3 py-2 text-center">
                    <button class="bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 text-xs">Ubah</button>
                    <button class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 text-xs ml-1">Profil</button>
                </td>
            </tr>
        `;
    }
    document.getElementById('asnTableBody').innerHTML = tbody || `<tr><td colspan="10" class="text-center text-gray-500">Data tidak ditemukan</td></tr>`;
    let info = total === 0
        ? 'Menampilkan 0 data'
        : `Menampilkan ${startIdx + 1} sampai ${endIdx} dari ${total} data`;
    document.getElementById('paginationInfo').innerText = info;
    // Pagination
    let totalPages = Math.ceil(total / rowsPerPage);
    let nav = '';
    nav += `<button ${currentPage === 1 ? 'disabled' : ''} class="px-2 py-1 rounded border text-gray-600 hover:bg-gray-100" data-page="prev">Sebelumnya</button>`;
    let maxShow = 5;
    let start = Math.max(1, currentPage - 2);
    let end = Math.min(totalPages, start + maxShow - 1);
    for (let p = start; p <= end; p++) {
        nav += `<button class="px-2 py-1 rounded border ${currentPage === p ? 'font-bold bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}" data-page="${p}">${p}</button>`;
    }
    if (end < totalPages) nav += `<span class="px-2">...</span><button class="px-2 py-1 rounded border text-gray-600 hover:bg-gray-100" data-page="${totalPages}">${totalPages}</button>`;
    nav += `<button ${currentPage === totalPages ? 'disabled' : ''} class="px-2 py-1 rounded border text-gray-600 hover:bg-gray-100" data-page="next">Selanjutnya</button>`;
    document.getElementById('paginationNav').innerHTML = nav;
    document.querySelectorAll('#paginationNav [data-page]').forEach(btn => {
        btn.onclick = function () {
            let page = this.getAttribute('data-page');
            if (page === 'prev' && currentPage > 1) currentPage--;
            else if (page === 'next' && currentPage < totalPages) currentPage++;
            else if (!isNaN(page)) currentPage = parseInt(page);
            renderTablePage();
        }
    });
}



function renderNotAvailable(menuTitle) {
    document.getElementById('mainContent').innerHTML = `
        <div class="flex flex-col items-center justify-center min-h-[250px] bg-white rounded-xl shadow-md py-12">
            <svg class="w-16 h-16 text-blue-400 mb-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M12 2a10 10 0 110 20 10 10 0 010-20z" />
            </svg>
            <div class="text-2xl font-bold mb-2 text-gray-700">${menuTitle}</div>
            <div class="text-gray-600">Fitur belum tersedia.</div>
        </div>
    `;
}

function renderPengaturan(selected = 'akses') {
    document.getElementById('mainContent').innerHTML = `
        <div class="bg-white rounded-xl shadow-md p-4">
            <div class="text-2xl font-bold text-gray-800 mb-2 text-center">Pengaturan</div>
            <div class="flex gap-2 justify-center mb-4">
                <button id="submenuAkses" class="px-5 py-2 rounded-lg text-sm font-semibold border
                    ${selected==='akses' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800 hover:bg-blue-50'}">
                    Akses Menu
                </button>
                <button id="submenuUser" class="px-5 py-2 rounded-lg text-sm font-semibold border
                    ${selected==='user' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800 hover:bg-blue-50'}">
                    User
                </button>
            </div>
            <div id="pengaturanContent"></div>
        </div>
    `;
    // Submenu listener
    document.getElementById('submenuAkses').onclick = () => renderPengaturan('akses');
    document.getElementById('submenuUser').onclick = () => renderPengaturan('user');

    // Isi content
    if (selected === 'akses') {
        document.getElementById('pengaturanContent').innerHTML = `<div class="text-center text-gray-600 py-6">Halaman pengaturan <b>Akses Menu</b> belum tersedia.</div>`;
    } else {
        renderUserTable(); // <--- tampilkan tabel user!
    }
}

function renderUserTable() {
    document.getElementById('mainContent').innerHTML = `
    <div class="bg-white rounded-xl shadow-md p-4">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-2">
            <div class="text-2xl font-bold text-gray-800 text-center w-full md:w-auto mb-2 md:mb-0">Data User</div>
            <button id="addUserBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-bold shadow">Tambah User</button>
        </div>
        <div class="overflow-auto rounded">
            <table class="min-w-full text-sm text-left">
                <thead>
                    <tr class="bg-blue-50 border-b">
                        <th class="px-3 py-2 text-center">No.</th>
                        <th class="px-3 py-2">Email</th>
                        <th class="px-3 py-2">Nama</th>
                        <th class="px-3 py-2">Tipe User</th>
                        <th class="px-3 py-2 text-center">Aksi</th>
                    </tr>
                </thead>
                <tbody id="userTableBody"></tbody>
            </table>
        </div>
    </div>
    `;

    // Fetch user dari Apps Script
    google.script.run.withSuccessHandler(function(users) {
        let rows = "";
        users.forEach((user, idx) => {
            rows += `
            <tr class="border-b hover:bg-blue-50">
                <td class="px-3 py-2 text-center">${idx + 1}</td>
                <td class="px-3 py-2">${user.email}</td>
                <td class="px-3 py-2">${user.nama}</td>
                <td class="px-3 py-2">${user.tipe_user}</td>
                <td class="px-3 py-2 text-center">
                    <button class="editUserBtn bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 text-xs" data-id="${user.id}">Ubah</button>
                    <button class="deleteUserBtn bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-xs ml-1" data-id="${user.id}">Hapus</button>
                </td>
            </tr>
            `;
        });
        document.getElementById('userTableBody').innerHTML = rows;

        // Set event listener Edit/Hapus
        document.querySelectorAll('.editUserBtn').forEach(btn => {
            btn.addEventListener('click', function() {
                const id = this.getAttribute('data-id');
                const user = users.find(u => u.id === id);
                showUserForm('edit', user, id);
            });
        });
        document.querySelectorAll('.deleteUserBtn').forEach(btn => {
            btn.addEventListener('click', function() {
                const id = this.getAttribute('data-id');
                const user = users.find(u => u.id === id);
                // Tampilkan modal
                document.getElementById('hapusUserNama').innerText = user ? user.email + ' - ' + user.nama : '';
                document.getElementById('modalHapusUser').classList.remove('hidden');
                // Simpan id user yg akan dihapus (bisa pakai data attr)
                document.getElementById('btnKonfirmasiHapus').setAttribute('data-id', id);
            });
        });
    }).getUsers();

    // Tambah user
    setTimeout(() => {
        document.getElementById('addUserBtn').onclick = function() {
            showUserForm('add');
        };
    }, 300);
}

// DI BAWAHNYA! (bukan di dalam renderUserTable)
document.getElementById('btnBatalHapus').onclick = function() {
    document.getElementById('modalHapusUser').classList.add('hidden');
};
document.getElementById('btnKonfirmasiHapus').onclick = function() {
    const id = this.getAttribute('data-id');
    document.getElementById('modalHapusUser').classList.add('hidden');
    google.script.run.withSuccessHandler(renderUserTable).deleteUser(id);
};

// Form Tambah/Edit User
function showUserForm(mode, user = {}, docId = null) {
    document.getElementById('mainContent').innerHTML = `
        <div class="bg-white rounded-xl shadow-md p-6 max-w-lg mx-auto">
            <div class="text-xl font-bold mb-4">${mode === 'add' ? 'Tambah' : 'Edit'} User</div>
            <form id="userForm" class="space-y-3">
                <input type="text" id="userEmail" class="w-full p-2 border rounded" placeholder="Email" value="${user.email || ''}" required>
                <input type="text" id="userNama" class="w-full p-2 border rounded" placeholder="Nama" value="${user.nama || ''}" required>
                <input type="text" id="userPassword" class="w-full p-2 border rounded" placeholder="Password" value="${user.password || ''}" required>
                <select id="userTipe" class="w-full p-2 border rounded" required>
                    <option value="">Pilih Tipe User</option>
                    <option value="admin" ${user.tipe_user === 'admin' ? 'selected' : ''}>admin</option>
                    <option value="user" ${user.tipe_user === 'user' ? 'selected' : ''}>user</option>
                </select>
                <div class="flex justify-end gap-2 pt-2">
                    <button type="button" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded" id="batalUserBtn">Batal</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-bold">${mode === 'add' ? 'Simpan' : 'Update'}</button>
                </div>
            </form>
        </div>
    `;
    document.getElementById('batalUserBtn').onclick = renderUserTable;
    document.getElementById('userForm').onsubmit = function(e) {
        e.preventDefault();
        const data = {
            email: document.getElementById('userEmail').value,
            nama: document.getElementById('userNama').value,
            password: document.getElementById('userPassword').value,
            tipe_user: document.getElementById('userTipe').value
        };
        if (mode === 'add') {
            google.script.run.withSuccessHandler(renderUserTable).addUser(data);
        } else {
            google.script.run.withSuccessHandler(renderUserTable).updateUser(docId, data);
        }
    };
}

</script>

</div>
    <script>
    function showMenuForRole(tipe_user) {
        const adminMenus = document.querySelectorAll('.menu-admin');
        if (tipe_user !== 'admin') {
            adminMenus.forEach(item => item.style.display = 'none');
        } else {
            adminMenus.forEach(item => item.style.display = '');
        }
    }
    // Aktifkan menu pada login sukses
    // Panggil: showMenuForRole(response.tipe_user);

    document.querySelectorAll('#mainMenu a').forEach(link => {
        link.addEventListener('click', function(e) {
            document.querySelectorAll('#mainMenu a').forEach(l => l.classList.remove('bg-blue-900', 'font-bold'));
            this.classList.add('bg-blue-900', 'font-bold');
            const menu = this.getAttribute('data-menu');
            if (menu === 'beranda') {
                renderDashboardBox();
            } else if (menu === 'asn') {
                renderNotAvailable('Data ASN');
            } else if (menu === 'pns') {
                renderNotAvailable('Data PNS');
            } else if (menu === 'cpns') {
                renderNotAvailable('Data CPNS');
            } else if (menu === 'pppk') {
                renderNotAvailable('Data PPPK');
            } else if (menu === 'pangkat') {
                renderNotAvailable('Data Pangkat');
            } else if (menu === 'gaji') {
                renderNotAvailable('Data Gaji Berkala');
            } else if (menu === 'mutasi') {
                renderNotAvailable('Data Mutasi');
            } else if (menu === 'pensiun') {
                renderNotAvailable('Data Pensiun');
            } else if (menu === 'log') {
                renderNotAvailable('Log');
            } else if (menu === 'pengaturan') {
                renderNotAvailable('Pengaturan');
            }
            e.preventDefault();
        });
    });

    // Handler menu utama (tempel SATU KALI saja!)
    document.querySelectorAll('#mainMenu a').forEach(link => {
        link.addEventListener('click', function(e) {
            document.querySelectorAll('#mainMenu a').forEach(l => l.classList.remove('bg-blue-900', 'font-bold'));
            this.classList.add('bg-blue-900', 'font-bold');
            const menu = this.getAttribute('data-menu');
            if (menu === 'beranda') {
                renderDashboardBox();
            } else if (menu === 'asn') {
                renderDataASN();
            } else if (menu === 'pengaturan') {
                renderPengaturan();
            } else {
                let titles = {
                    pns: 'Data PNS', cpns: 'Data CPNS', pppk: 'Data PPPK', pangkat: 'Data Pangkat',
                    gaji: 'Data Gaji Berkala', mutasi: 'Data Mutasi', pensiun: 'Data Pensiun', log: 'Log'
                };
                renderNotAvailable(titles[menu] || 'Fitur');
            }
            e.preventDefault();
        });
    });

    // Toggle submenu dengan klik (untuk mobile dan desktop)
    document.getElementById('menuPengaturanBtn').addEventListener('click', function(e) {
        e.preventDefault();
        const submenu = document.getElementById('submenuPengaturan');
        if(submenu.classList.contains('hidden')) {
            submenu.classList.remove('hidden');
            submenu.classList.add('flex');
        } else {
            submenu.classList.remove('flex');
            submenu.classList.add('hidden');
        }
        // Tutup dropdown jika klik di luar
        document.addEventListener('click', function docListener(ev) {
            if (!submenu.contains(ev.target) && ev.target !== document.getElementById('menuPengaturanBtn')) {
                submenu.classList.remove('flex');
                submenu.classList.add('hidden');
                document.removeEventListener('click', docListener);
            }
        });
    });

    document.querySelectorAll('[data-subpengaturan]').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            // Tutup dropdown setelah klik
            const submenu = document.getElementById('submenuPengaturan');
            submenu.classList.remove('flex');
            submenu.classList.add('hidden');
            // Render halaman pengaturan sesuai sub
            const sub = this.getAttribute('data-subpengaturan');
            renderPengaturan(sub);
        });
    });
    </script>

    <script>
let loginUserState = null;

// Fungsi untuk menampilkan halaman yang sesuai
function showPage(page) {
    document.getElementById('loginpage').style.display = page === 'login' ? 'block' : 'none';
    document.getElementById('dashboardpage').style.display = page === 'dashboard' ? 'block' : 'none';
}

// Menangani proses login saat form disubmit
document.getElementById("loginForm").addEventListener("submit", function(event){
    event.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const btn = document.getElementById('loginButton');
    const btnText = document.getElementById('buttonText');
    const spinner = document.getElementById('buttonSpinner');

    btn.disabled = true;
    btnText.innerText = 'Memproses...';
    spinner.classList.remove('hidden');
    document.getElementById('error').innerText = '';

    fetch('https://cf01cbe46f1d.ngrok-free.app/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
    })
    .then(res => res.json())
    .then(function(response) {
        btn.disabled = false;
        btnText.innerText = 'Login';
        spinner.classList.add('hidden');

        if (response.status === 'ok') {
            loginUserState = response;
            document.getElementById('userLabel').innerText = `${response.nama} (${response.tipe_user})`;
            showMenuForRole(response.tipe_user);
            showPage('dashboard');
            renderDashboardBox();
            document.querySelectorAll('#mainMenu a').forEach(l => l.classList.remove('bg-blue-900', 'font-bold'));
            document.querySelector('#mainMenu a[data-menu="beranda"]').classList.add('bg-blue-900', 'font-bold');
        } else {
            document.getElementById('error').innerText = response.message;
        }
    })
    .catch(function(error) {
        btn.disabled = false;
        btnText.innerText = 'Login';
        spinner.classList.add('hidden');
        document.getElementById('error').innerText = 'Gagal terhubung ke server.';
    });
});

// Menangani proses logout
function logoutUser() {
    loginUserState = null;
    document.getElementById('email').value = '';
    document.getElementById('password').value = '';
    showPage('login');
}
</script>
    
    <!-- ...Akhir halaman sebelum </body> -->
    <!-- Toggle Dark/Light Theme -->
<button id="toggleTheme"
    class="fixed bottom-32 right-6 z-50 bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-100 p-3 rounded-full shadow-lg transition-all duration-300 opacity-70 hover:opacity-100 group"
    title="Ganti Dark/Light Mode" style="opacity:0.2;">
    <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
        viewBox="0 0 24 24" stroke="currentColor"></svg>
</button>

<style>
  #toggleTheme { opacity: 0.2; transition: opacity 0.4s; }
  #toggleTheme.show { opacity: 1; }
</style>

<script>
  // Atur icon tema
  function setThemeIcon(isDark) {
    const icon = document.getElementById('themeIcon');
    if (!icon) return;
    if (isDark) {
      icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"/>`;
    } else {
      icon.innerHTML = `<circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" fill="none"/>
        <path stroke="currentColor" stroke-width="2" d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42
        M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>`;
    }
  }

  // Inisialisasi tema
  function getInitialTheme() {
    if (localStorage.getItem('theme') === 'dark') return true;
    if (localStorage.getItem('theme') === 'light') return false;
    return window.matchMedia('(prefers-color-scheme: dark)').matches;
  }
  function applyTheme(isDark) {
    if (isDark) document.documentElement.classList.add('dark');
    else document.documentElement.classList.remove('dark');
    setThemeIcon(isDark);
  }

  document.addEventListener('DOMContentLoaded', function () {
    // Posisi naik (tidak menutupi)
    document.getElementById('toggleTheme').style.bottom = '110px';

    let isDark = getInitialTheme();
    applyTheme(isDark);

    document.getElementById('toggleTheme').addEventListener('click', function () {
      isDark = !document.documentElement.classList.contains('dark');
      applyTheme(isDark);
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    // AUTOHIDE + SHOW saat mouse dekat kanan bawah
    let themeBtn = document.getElementById('toggleTheme');
    let timeoutHide = null;

    function showThemeBtn() {
      themeBtn.classList.add('show');
      clearTimeout(timeoutHide);
      timeoutHide = setTimeout(() => themeBtn.classList.remove('show'), 1800);
    }

    document.addEventListener('mousemove', function(e) {
      let vw = window.innerWidth, vh = window.innerHeight;
      if (e.clientX > vw - 220 && e.clientY > vh - 220) showThemeBtn();
    });
    themeBtn.addEventListener('mouseenter', showThemeBtn);
    themeBtn.classList.remove('show');
  });
</script>


<script>
    function updateDateTime() {
        const days = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
        const now = new Date();
        const hari = days[now.getDay()];
        const tgl = now.toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit', year: 'numeric' });
        const jam = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        document.getElementById("datetimeArea").innerText = `${hari}, ${tgl} ${jam}`;
    }
    if (document.getElementById("datetimeArea")) {
        updateDateTime();
        setInterval(updateDateTime, 1000);
    }
</script>

</body>
</html>
